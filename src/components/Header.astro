---
import { Coins, User, Menu, X } from "lucide-preact";

const navLinks = [
  { href: "/#advantages", label: "Почему мы" },
  { href: "/#youtube", label: "О нас" },
  { href: "/#tariffs", label: "Цены", icon: Coins },
];
---

<header
  class="header fixed top-0 z-40 flex h-20 w-full items-center border-b border-transparent transition-[background-color,border-color,backdrop-filter] duration-300"
  role="banner"
>
  <div
    class="header__container relative z-40 container flex items-center justify-between px-5 py-4"
  >
    <a
      class="header__logo hover:text-primary active:text-primary focus-ring flex rounded text-xl font-bold text-neutral-100 transition-colors duration-300 md:text-2xl"
      href="/"
    >
      <img src="/logo.webp" alt="Логотип Pugovka Booster" class="w-24" width="96" height="32" fetchpriority="high" />
    </a>

    <nav class="header__nav hidden items-center gap-x-1 md:flex" aria-label="Основное">
      {
        navLinks.map((item) => {
          const Icon = item.icon;
          return (
            <a class="link-nav" href={item.href}>
              {Icon ? <Icon size={20} strokeWidth={2} /> : null}
              {item.label}
            </a>
          );
        })
      }
    </nav>

    <div class="flex items-center gap-x-2">
      <a
        class="link-outline focus-ring hidden! md:inline-flex!"
        href="https://cabinet.pugovkabooster.com/"
        aria-label="Войти в личный кабинет"
      >
        <User size={20} strokeWidth={2} aria-hidden="true" />
        Кабинет
      </a>
      <button
        type="button"
        class="mobile-menu-btn btn-icon focus-ring flex md:hidden!"
        aria-expanded="false"
        aria-controls="mobile-nav"
        aria-label="Открыть меню"
      >
        <Menu size={24} strokeWidth={2} />
        <X size={24} strokeWidth={2} />
      </button>
    </div>
  </div>

  <div
    id="mobile-nav"
    class="mobile-nav fixed inset-0 z-30 hidden min-h-dvh flex-col bg-neutral-900 px-5 pt-24 pb-8"
    aria-hidden="true"
    aria-label="Мобильное меню"
  >
    <div class="flex min-h-0 flex-1 flex-col gap-1">
      {
        navLinks.map((item) => {
          const Icon = item.icon;
          return (
            <a
              class="link-nav gap-x-3 border border-transparent py-3.5 text-neutral-200 hover:border-neutral-700/50 active:border-neutral-700/50"
              href={item.href}
            >
              {Icon ? <Icon size={22} strokeWidth={2} className="text-primary/80" /> : null}
              {item.label}
            </a>
          );
        })
      }
    </div>
    <a
      class="btn-primary mt-auto shrink-0 rounded-xl px-4 py-3.5"
      href="https://cabinet.pugovkabooster.com/"
      aria-label="Войти в личный кабинет"
    >
      <User size={22} strokeWidth={2} aria-hidden="true" />
      Кабинет
    </a>
  </div>
</header>

<script>
  const initHeaderScroll = () => {
    const header = document.querySelector(".header");
    if (!header) return;
    const headerEl = header;
    const updateHeader = () => {
      headerEl.classList.toggle("header--scrolled", window.scrollY > 0);
    };
    updateHeader();
    window.addEventListener("scroll", updateHeader, { passive: true });
  };

  const initMobileMenu = () => {
    const btn = document.querySelector(".mobile-menu-btn");
    const nav = document.getElementById("mobile-nav");
    if (!btn || !nav) return;
    const btnEl = btn;
    const navEl = nav;

    const openMenu = () => {
      navEl.classList.remove("hidden");
      navEl.classList.add("flex");
      btnEl.setAttribute("aria-expanded", "true");
      btnEl.setAttribute("aria-label", "Закрыть меню");
      document.body.style.overflow = "hidden";
    };

    const closeMenu = () => {
      navEl.classList.add("hidden");
      navEl.classList.remove("flex");
      btnEl.setAttribute("aria-expanded", "false");
      btnEl.setAttribute("aria-label", "Открыть меню");
      document.body.style.overflow = "";
    };

    const toggleMenu = () => {
      navEl.classList.contains("flex") ? closeMenu() : openMenu();
    };

    btnEl.addEventListener("click", toggleMenu);
    navEl.querySelectorAll("a").forEach((link) => link.addEventListener("click", closeMenu));
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && navEl.classList.contains("flex")) closeMenu();
    });
  };

  initMobileMenu();
  initHeaderScroll();
</script>
